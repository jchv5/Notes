
****Comandos para files

ls usr/bin =          binarios ejecutables del sistema.
ls usr/bin | wc -l =  muestra el numero de binarios ejecutables.
pwd =                 te muestra la ruta actual.
control + l =         limpia la consola de linux.
cd nombre-carpeta =   ingresa a una carpeta.
cd .. =               sale de una carpeta.
ls -lh =              mustra el tipo de archivo, fecha, y el peso en B,G,k.
ls -lha =             muestra los archivos ocultos.
cd + tab =            auto completa las carpetas o archivos que existan.
cd ~ =                me redirije a mi ruta principal.
mkdir =               crea una nueva carpeta.
touch =               sirve para crear un archivo.
mv actual futuro =    cambia el nombre del archivo o carpeta.
rm archivo.md =       elimina un archivo sin preguntar.
rm -rf carpeta =      elimina una carpeta sin preguntar.
man comando =         muestra el manual de tal comando.
mv archivo.txt carpteta/ =          mueve el archivo a tal carpeta.
mv archivo.txt ~/desktop/carpeta =  mueve el archivo a rutas anteriores.
cp archivo ../ruta =                copia el archivo y lo pega en la ruta especificada.
pushd ~/desktop =     accede a la ruta sin necesidad de hacer un cd.
popd =                regresa a la ruta anterior en necesidad de hacer cd. referencia de pushd.
open nombre_archivo = habre el archivo
more archivo.txt =    muestra las primeras lineas del archivo.
cat > archivo.txt =   sirve para pegar o agregar informacion. termina con control+c.
tail archivo.txt =    muestra las ultimas 10 lineas.
vim archivo.ext =     habre un editor de texto, presione "i" para escribir, presione "esc" y ":wq" para guardar y ":q!" para salir.
more > archivo.txt =  muestra una parte del archivo.
echo $PATH =          mustra todas las rutas de los programa que tienen permisos.
alias ver='ls' =      crea un sobrenombre del comando.
control + r =         busca comandos ejecutados anteriormente.
top =                 muestra todo el proceso que correr el ordenador.
grep palabra file.extencion =       busca palabras claves en archivos.
grep -r . =           muestra los archivos y los contenidos de esos archivos.
grep -r               carpeta -e palabra = busca la palabra dentro de la carpeta asignada.
grep -n -r carpeta -e palabra =     busca y muestra el numero de lineas del archivo.
ls *extencion txt,jpg,mp3 =         lista los archivos que contenga la extencion escrita.
find . -type d | wc -l =            muestra el numero de directorio que existan.
curl direccion de internet =        muestra el archivo con el que esta escrito la pagina.
wget direccion de internet =        util para descargar archivos.
gig direccion de internet =         util para saber la ip de ese sitio.
tree =                              muestra el arbol de directorios.
gzip file.extension =               comprime el archivo.
gzip -d file.extension =            descomprime el archivo.
zip nombre.zip *extencion =         comprime los archivos con esas extenciones en zip.
tar cfz nombre.tar.gz *extencion =  comprime los archivos con esa extencion.
tar xfz varios.tar.gz =             descomprime  el archivo tar.
tar cf name.extension carpeta/* =   empaqueta todo los archivos de la carpeta.
tar tf name.tar =                   ve el contenido del empaquetado.
tar xf name.tar =                   desempaqueta el tar.
cat archivo.txt =                   imprime el contenido del archivo.
ls | wc -l =                        muestra en general la cantidad de contenido que existe.
whoami =                            muestra con que usuarios estas logueado.
locate name.extension =             busca el archivo y muestra su ruta.
sudo updatedb =                     actualiza la base de datos.
ssh-keygen -t rsa -b 4096 =         sirve para crear llaves ssh de privadas y publicas. 
ssh 45.55.62.127@root =             se conecta a un servidor remoto mediante ip.
ping direccion_id =                 muestra las respuesta activa del servidor.
echo "title" | mail -s "contenido" direccion de correo =    envia un email.
nl archivo.txt =                    enumera las lineas de un archivo.
wc -l archivo.txt =                 muestra el numero de lineas que tenga.
wc -w archivo.txt =                 muestra el numero de palabras.
wc -m archivo.txt =                 muestra el numero de letras o caracteres.
sed 's/mi palabra/sustitucion/g' archivo.txt =        sustituye la palabra asignada por la palabra especificada. "g" significa global.
sed -i 's/palabra/sustitucion/g' archivo.txt =        sustituye la palabra asignada y guarda el archivo con los cambios.
sed -i.orig 's/palabra/sustitucion/g' archivo.txt =   sustituye la palabra asignada y guarda el archivo con los cambios en una copia aparte.
sleep 5 && cat archivo.txt =                          simula la ejecucion de algo por 5 segundos luego ejecuta el seguiente comando.
df -h =               muestra el sistema de fichero como nombre, tamaño, ruta.
df -h --total =       mustra el sistema de fichero con calculos totales.

					USUARIOS Y GRUPOS
sudo su - =           sirve para cambiar de mi usuario a root es decir a superUsuario administrador.
sudo su usuario =     sirve para cambiar de usuarios.
adduser usuario =     sirve para crear un usuario. (solo funciona en root).
control + d =         para cerrar session.
deluser usuario =     elimina un usuario.
passwd mejorandola =  sirve para cambiar la contraseña.

sudo su            Este comando en Ubuntu es para pasarte a usuario root desde un usuario cualquiera
su - 'username'    Este comando te sacara del root user, y te llevara al user ingresado


****Comandos para lectura

cat
    Recomendado para leer archivos pequeños.
cat /var/log/auth.log 

less
    Recomendado para leer archivos largos.
less /var/log/auth.log

head
    Muestra las ultimas 10 lineas de un archivo.
head /var/log/auth.log (con modificador head -n + el numero de lineas deseadas)

tail
    Muestra las primeras 10 lineas de un archivo.
tail /var/log/auth.log (con modificador tail -n + el numero de lineas deseadas)

Seguimiento en tiempo real para el login session mediante el comando:
    tail -f /var/log/auth.log
    
    
    
  ****Interacción con archivos y permisos
  
  Identificar los archivos basándonos en el primer carácter:
-: Es un archivo.
d: es un directorio.
l: enlace simbólico.

Todo en Linux se considera un archivo.

Seguido del primer carácter vienen 9 caracteres, los 3 primeros son para el usuario, los siguientes 3 para el grupo y los últimos 3 para otros usuarios del OS:

    r: read - lectura.
    w: write - escritura.
    x: execution - ejecución.
    
    Owner - group - others
    rwx   - r-x   - --x
    
    chmod u+x +name of the file

Para cambiar permisos en el OS:
chmod
Tiene dos maneras de usarse:

    Con letras: ugoa … user, group, others, all
    chmod u+x   nombre_archivo ==> agregar un permiso.
    chmod g-w   nombre_archivo ==> quita permisos.
    chmod +x    nombre_archivo ==> quick way, asume que es para todos (a).

rwx: puede ejecutar script.
rw-: owner = cuales son los permisos.
r--: group = grupo que pertenece.
r--: anyone = que permisos tiene.
---: ni leerlo, ni escribir, ni ejecutar.


chmod = cambia los permisos;
chmod o-r file.extension =   quita el permiso de lectura de otros;
chmod g+x file.extension =   coloca el permiso de ejecucion de grupos; 

Con formato octal: son número del 0 al 7, cada letra significa algo especifico.

r = 4
w = 2
x = 1
- = 0

r--: leer 
rw-: leer y escribir 
r-x: leer y ejecutar
--x: ejecutar
-wx: escribir y ejecutar
rwx: permiso de todo

r=4, x=1, w=2

Para cambiar de Owner en el archivo:
chown ==> Change owner

chown +new user:new group +file name



****Terminales en linux

Las distribuciones de Linux para servidores no incluyen interfaz gráfica, ya que consumen muchos recursos. Esto significa que siempre vamos a trabajar desde la terminal.

Tendremos disponibles 6 terminales virtuales a las que podemos entrar o salir con las teclas: Ctrl + Alt + Fx (osea las teclas F1-F6). 
También podemos usar el comando: chvt. La séptima terminal es la interfaz gráfica, así que en este caso no disponemos de ella.

Cada usuario activo en nuestro sistema operativo crea una nueva conexión. Podemos ver todas estas conexiones con los comandos: who y w 
(este último nos da un poco más de información).

Para ver todos los procesos que corren en el sistema podemos usar el comando ps. Para filtrar los procesos y ver únicamente las conexiones 
de los usuarios usamos el comando: ps -ft tty.

Este comando nos muestra el identificador de cada proceso. Para terminarlo podemos usar el comando: kill -9 PID



*****Monitoreo de procesos y recursos del sistema

htop ==> muestra una mejor organización de la información de los procesos del sistema

Disco duro: du . Tiene un modificador para mostrar el peso de una ruta especifica: du -hsc /home/platzi.
En ciertos casos este comando require de permisos 

cat /proc/cpuinfo | grep "processor"      Muestra información sobre el CPU
sudo ps auxf | sort -nr -k 3 | head -5    Muestra los 5 procesos que más uso hacen del CPU
sudo ps auxf | sort -nr -k 4 | head -5    Muestra los 5 procesos que más uso hacen de la memoria RAM



****Análisis de los parámetros de red

Comandos

ifconfig    Interface Configuration, muestra las tarjetas de red que tenemos y su direccionamiento específico
ip a 	    IP Address Show, muestra las direcciones IP
hostname:   Como se identifica este equipo en la red
route -n    Muestra cual es el dispositivo que me permite conectarme a internet
nslookup    Muestra la dirección IP de un dominio determinado
curl 	    Realiza consultas a un servidor
wget 	    Permite descargar contenido de un servidor


Comandos útiles

ip -4 a   Muestra las direcciones IPv4
ip -6 a   Muestra las direcciones IPv6



****Administración/instalacion de paquetes acorde al OS


    Red Hat / CentOS / Fedora

Repositorios: yum
Extensión de paquetes: .rpm

Comandos:

rpm -qa 	     Lista todos los rpm instalados en la máquina
rpm -i paquete.rpm   Instala un paquete
rpm -e paquete.rpm   Desinstala un paquete
yum install paquete  Instala un paquete desde un repositorio
yum search paquete   Busca un paquete en un repositorio
	    
    Debian / Ubuntu
        
Repositorios: apt
Extensión de paquetes: .deb

Comandos:

dpkg -l 	     	   Lista todos los deb instalados en la máquina
dpkg -i paquete.deb        Instala un paquete
dpkg -r paquete.deb        Desinstala un paquete
dpkg-reconfigure paquete   Permite configurar nuevamente un paquete
apt install paquete 	   Instala un paquete desde un repositorio
apt search paquete	   Busca un paquete en un repositorio




/////******Manejo de paquetes en sistemas basados en Debian******\\\\\


date 			    Imprime la fecha actual
sudo apt update   	    Actualiza la información local sobre los repositorios de Ubuntu
sudo apt upgrade  	    Actualiza todos los programas que tenemos instalados en la máquina
 
 
Otra (nueva) manera de buscar paquetes: 

snap search file name       buscar un paquete.
snap refresh --list         Para ver toda la lista de paquetes.
snap info file name         verificar la información de un paquete especifico.

sudo snap install canonical-livepatch   
Instala un paquete con el nuevo gestor de paquetes de Canonical, snap ( el key/Live patch debe ser obtenido en: https://auth.livepatch.canonical.com/?_ga=2.246540228.1309143529.1600820175-360682673.1599848663 )

apt dist-upgrade            Realiza actualizaciones a escala de kernel. Estas actualizaciones siempre requieren reinicio, a no de ser de tener Live Patch permite 			      estas actualizaciones sin tener que hacer reinicio, pide registrar hasta 3 máquinas para este proceso.
dpkg-reconfigure tzdata     Para configurar la hora del servidor
apt dist-upgrade 	    Realiza actualizaciones a escala de kernel. Estas actualizaciones siempre requieren reinicio, a no de ser de tener Live Patch permite 			      estas actualizaciones sin tener que hacer reinicio, pide registrar hasta 3 máquinas para este proceso.

apt seach paquete ó apt-cache search
Para realizar busqueda de paquetes. Para refinar la búsqueda agregar al final del nombre de paquete $, y encerrar todo el nombre del paquete entre comillas. “mysql-server$”.




****Administración de software con YUM y RPM para CentOS


su   		        Este comando en Debian/centOS esvpara pasarte a usuario root desde un usuario cualquiera
su - 'username'         Este comando te sacara del root user, y te llevara al user ingresado

yum update     		(desde usuario root) actualizar repositorios.
rpm -e filename         Este comando sirve para el borrado de files
rpm -qa 		ver todos los paquetes instalados
rpm -qi bash   		Consultar información del paquete bash
rpm -qc bash   		Ver configuración de bash
yum install filename    Comando  utilizado para la instalacion de files
yum install net-tools:  Este paquete incluye las herramientas importantes para controlar el subsistema de red del núcleo Linux. Esto incluye arp, ifconfig, netstat, 			     rarp, nameif y route. Además, este paquete contiene utilidades relativas a tipos particulares de «hardware» de red (plipconfig, slattach, mii-			   tool) y aspectos avanzados de configuración IP (iptunnel, ipmaddr).
			Recordar que se debe tener cuidado con el tipo de enlaces que se agregan a los repositorios.



****Nagios: Desempaquetado, descompresión, compilación e instalación de paquetes

Nagios website: https://www.nagios.org/


    *Instalar los siguientes paquetes
    
sudo apt install build-essential libgd-dev openssl libssl-dev unzip apache2 php gcc libdbi-perl libdbd-mysql-perl


    *Descargar Nagios (link directo, opcional)
   
wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.4.4.tar.gz -O nagioscore.tar.gz


    *Descomprimir y desempaquetar el archivo descargado
    
tar xvzf nagioscore.tar.gz


    *Configurar e instalar (en la carpeta donde se descomprimieron los archivos) a Nagios
    

sudo ./configure --with-https-conf=/etc/apache2/sites-enabled
sudo make all
sudo make install

Si da error en el paso de ejecutar “sudo make install”, usar los comandos siguientes:
sudo make install-groups-users
sudo usermod -a -G nagios www-data (no bligatorio)

#Aporte del usuario @diegohernanvillalobos
#Si no les funciona "sudo make install" continuar con los siguientes comandos y ejecutar luego "sudo make install"
sudo make install-groups-users
sudo usermod -a -G nagios www-data
#Hasta aquí

sudo make install-init
sudo make install-commandmode
sudo make install-config
sudo make install-webconf


 # Activar el servicio de Nagios
    

sudo systemctl start nagios


 # BONUS: instalar plugins de Nagios
    

wget https://nagios-plugins.org/download/nagios-plugins-2.2.1.tar.gz -O nagios-plugins.tar.gz
tar xzvf nagios-plugins.tar.gz
cd nagios-plugins-2.2.1
sudo ./configure
sudo make all
sudo make install




/////Los usuarios, una tarea vital en el proceso de administración


# Comandos

id	 Muestra el identificador único de mi usuario, del grupo al que pertenezco y los grupos de los cuales formo parte
whoami   Muestra que usuario soy
passwd   Cambia la contraseña del usuario actual

# Comandos útiles

cat /etc/passwd   Muestra todos los usuarios del sistema operativo
cat /etc/shadow   Muestra las contraseñas del sistema operativo




/////Creando y manejando cuentas de usuario



    sudo useradd nombre-usuario  crea un usuario sin asignarle inmediatamente alguna contraseña ni consultar más información. Debemos terminar de configurar esta 
                                 cuenta a mano posteriormente.
    sudo adduser nombre-usuario  crea un nuevo usuario con contraseña y algo más de información. También creará una nueva carpeta en la carpeta /home/.
                                 userdel nombre-usuario: eliminar cuentas de usuarios.
    usermod: 			 modificar la información de alguna cuenta.

    cat /etc/passwd 		 Utilizado para ver los users en el sistema, nunca modificar este comando (para filtrar un user especifico usar:  | grep username)
    
    
    /////Entendiendo la membresía de los grupos
    
    
su - user 	     	         Switch User, cambia de usuario
groups user	    		 Muestra a que grupos pertenece cierto usuario
sudo gpasswd -a user group       Agrega un usuario a un grupo
sudo gpasswd -d user group       Quita a un usuario de un grupo
usermod -aG user group           Agrega un usuario a un grupo
sudo -l				 Muestra que permisos tiene el usuario actual
    


///// Usando PAM para el control de acceso de usuarios


# Comandos

pwscore   	    Evalúa si una contraseña es buena o mala del 0 al 100
ulimit   	    Muestra los permisos que tiene el usuario actual. 
ulimit -u numero    Cambia la cantidad de procesos que mi usuario puede ejecutar
sudo apt libpwquality-tools   Recuerda que para usar estos comando en sistemas basados en Ubuntu debemos instalar este paquete

# Comandos útiles

sudo vi /etc/security/time.conf   Modifica el archivo que indica en que horarios pueden conectarse ciertos usuarios









    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    




    
